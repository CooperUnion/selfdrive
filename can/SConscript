Import('env')

OPENCAN_BIN = env.File('../../build/cargo/bin/opencan-cli')

CAN_YML = env.File('can.yml')

# generate C files
GEN_FILENAMES = [f'opencan_{x}' for x in ['rx.c', 'rx.h', 'tx.c', 'tx.h', 'callbacks.h', 'templates.h']]

gen_files = env.Command(
        GEN_FILENAMES,
        CAN_YML,
        f'{OPENCAN_BIN} codegen $SOURCE $TARGET.dir BRAKE'
)

env.Alias('ccan', gen_files)
