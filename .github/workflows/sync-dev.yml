on:
  push:
    branches:
      - master_test

jobs:
  make-sync-pr:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Make PR
      id: cpr
      uses: peter-evans/create-pull-request@v4
      with:
        branch: dev
        title: "[!AUTOSYNC!] Merge out-of-sync changes from `master` into `dev`:grey_exclamation:"
        body: "Hello! This PR has been automatically generated because you need to merge out-of-sync changes from `master` into `dev`."
        labels: |
          autosync
          URGENT

    - name: Enable Pull Request Automerge
      if: steps.cpr.outputs.pull-request-operation == 'created'
      uses: peter-evans/enable-pull-request-automerge@v2
      with:
        pull-request-number: ${{ steps.cpr.outputs.pull-request-number }}
        merge-method: rebase
